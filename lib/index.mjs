/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(){return(t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function e(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function u(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))}function n(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}var r=t=>{const e=typeof t;return null!==t&&("object"===e||"function"===e)};const o=new Set(["__proto__","prototype","constructor"]);function i(t){const e=t.split("."),n=[];for(let t=0;t<e.length;t++){let r=e[t];for(;"\\"===r[r.length-1]&&void 0!==e[t+1];)r=r.slice(0,-1)+".",r+=e[++t];n.push(r)}return n.some(t=>o.has(t))?[]:n}var s={get(t,e,n){if(!r(t)||"string"!=typeof e)return void 0===n?t:n;const o=i(e);if(0!==o.length){for(let e=0;e<o.length;e++)if(null==(t=t[o[e]])){if(e!==o.length-1)return n;break}return void 0===t?n:t}},set(t,e,n){if(!r(t)||"string"!=typeof e)return t;const o=t,s=i(e);for(let e=0;e<s.length;e++){const o=s[e];r(t[o])||(t[o]={}),e===s.length-1&&(t[o]=n),t=t[o]}return o},delete(t,e){if(!r(t)||"string"!=typeof e)return!1;const n=i(e);for(let e=0;e<n.length;e++){const o=n[e];if(e===n.length-1)return delete t[o],!0;if(t=t[o],!r(t))return!1}},has(t,e){if(!r(t)||"string"!=typeof e)return!1;const n=i(e);if(0===n.length)return!1;for(let e=0;e<n.length;e++){if(!r(t))return!1;if(!(n[e]in t))return!1;t=t[n[e]]}return!0}};const u=new Map;function c(t,e){e={caseSensitive:!1,...e};const n=t+JSON.stringify(e);if(u.has(n))return u.get(n);const r="!"===t[0];r&&(t=t.slice(1)),t=(t=>{if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(t).replace(/\\\*/g,"[\\s\\S]*");const o=new RegExp(`^${t}$`,e.caseSensitive?"":"i");return o.negated=r,u.set(n,o),o}var a=(t,e,n)=>{if(!Array.isArray(t)||!Array.isArray(e))throw new TypeError(`Expected two arrays, got ${typeof t} ${typeof e}`);if(0===e.length)return t;const r="!"===e[0][0];e=e.map(t=>c(t,n));const o=[];for(const n of t){let t=r;for(const r of e)r.test(n)&&(t=!r.negated);t&&o.push(n)}return o};a.isMatch=(t,e,n)=>{const r=Array.isArray(t)?t:[t],o=Array.isArray(e)?e:[e];return r.some(t=>o.every(e=>{const r=c(e,n),o=r.test(t);return r.negated?!o:o}))};var l=["[object Array]","[object Boolean]","[object Null]","[object Object]"];function h(t){try{var e=JSON.parse(t),n=Object.prototype.toString.call(e);return l.includes(n)||"[object Number]"===n&&function(t){return!isNaN(parseFloat(t))&&parseFloat(t.toString()).toString()===t.toString()}(t)}catch(t){return!1}}function f(t,e){void 0===e&&(e=!0);var n,r=(n=t,"[object String]"===Object.prototype.toString.call(n)&&function(t){return new RegExp("^(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?$","gi").test(t)}(t)?function(t){return Buffer.from(t,"base64").toString("binary")}(t):t);return r&&h(r)&&e?JSON.parse(r):r}function p(t){return"[object Array]"===Object.prototype.toString.call(t)}function v(t){return"[object Object]"===Object.prototype.toString.call(t)}var d=function(){function e(e,n){if(void 0===n&&(n={}),this.options={json:!0},!e)throw Error("Storage type not declared in constructor");if("undefined"!=typeof window&&!(e in window))throw Error("Your browser does not support "+e);switch(e){case"localStorage":this.title="localPorridge";break;case"sessionStorage":this.title="sessionPorridge";break;default:throw"Invalid storage type specified"}this.options=t(t({},this.options),n),this.storageType=e}return e.prototype.getItem=function(e,n,r){if(void 0===n&&(n=""),void 0===r&&(r={}),r=t(t({},this.options),r),n){var o=this.getItem(e,"",r)||{};return s.get(o,n)}var i=globalThis[this.storageType].getItem(e);return i&&h(i)&&!0===r.json?JSON.parse(i):i},e.prototype.getJSON=function(t,e){return void 0===e&&(e=""),this.getItem(t,e,{json:!0})},e.prototype.getBase64=function(e,n,r){void 0===n&&(n=""),void 0===r&&(r={}),r=t(t({},this.options),r);var o,i=this.getItem(e,null,r);if((null==n?void 0:n.length)||!0===r.json){var u=f(i);o=(null==n?void 0:n.length)?s.get(u,n):u}else o=f(i,!1);return o},e.prototype.getItems=function(e,n){var r,o=this;if(void 0===n&&(n={}),p(e))return e.map((function(e){var i,s,u;return"string"==typeof e?(r=o.getItem(e,null,n),n.keyVal?((i={})[e]=r,i):r):v(e)?(n=t(t({},n),e.options),r=o.getItem(e.key,e.subKey,n),n.keyVal?((s={})[e.key]=r,s):r):p(e)?(n=t(t({},n),e[2]),r=o.getItem(e[0],e[1],n),n.keyVal?((u={})[e[0]]=r,u):r):void 0}))},e.prototype.getMatch=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n={});var r=this._getMatches(t).map((function(t){return{key:t,subKey:e}}));return r.length?this.getItems(r,n):null},e.prototype.removeItem=function(t,e){if(void 0===e&&(e=""),null==e?void 0:e.length){var n=this.getItem(t)||{};return s.delete(n,e),this.setItem(t,n)}return globalThis[this.storageType].removeItem(t)},e.prototype.removeItems=function(t,e){var n=this;if(void 0===e&&(e=""),p(t))return t.map((function(t){return"string"==typeof t?n.removeItem(t,e):v(t)?n.removeItem(t.key,t.subKey||e):p(t)?n.removeItem(t[0],t[1]||e):void 0}))},e.prototype.removeMatch=function(t,e){void 0===e&&(e=""),"*"===t&&this.clear();var n=this._getMatches(t);return n.length?this.removeItems(n,e):null},e.prototype.setItem=function(t,e,n,r){if(void 0===n&&(n=""),void 0===r&&(r={}),(null==n?void 0:n.length)||!0===r.json){var o=this.getItem(t)||{};return s.set(o,n,e),this.setItem(t,o)}var i,u,c=(i=e,u=Object.prototype.toString.call(i),l.includes(u)?JSON.stringify(e):e);return globalThis[this.storageType].setItem(t,c)},e.prototype.setItems=function(t,e){var n=this;if(void 0===e&&(e={}),p(t))return t.map((function(t){return v(t)?n.setItem(t.key,t.value,t.subKey,t.options||e):p(t)?n.setItem(t[0],t[1],t[2],t[3]||e):void 0}))},e.prototype.setJSON=function(t,e,n){return void 0===n&&(n=""),this.setItem(t,e,n,{json:!1})},e.prototype.key=function(t){return globalThis[this.storageType].key(t)},Object.defineProperty(e.prototype,"length",{get:function(){return globalThis[this.storageType].length},enumerable:!1,configurable:!0}),e.prototype.clear=function(){return globalThis[this.storageType].clear()},e.prototype._getMatches=function(t){var e=Object.keys(globalThis[this.storageType])||[],n=p(t)?t:[t];return a(e,n,{caseSensitive:!0})},e}();function g(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function y(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=g(n);return(t,n)=>r.then(r=>n(r.transaction(e,t).objectStore(e)))}let m;function b(){return m||(m=y("keyval-store","keyval")),m}function w(t,e=b()){return e("readonly",e=>g(e.get(t)))}function I(t,e,n=b()){return n("readwrite",n=>(n.put(e,t),g(n.transaction)))}function j(t,e=b()){return e("readwrite",e=>(e.delete(t),g(e.transaction)))}function S(t=b()){return t("readwrite",t=>(t.clear(),g(t.transaction)))}function k(t=b()){const e=[];return function(t,e){return t("readonly",t=>(t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},g(t.transaction)))}(t,t=>e.push(t.key)).then(()=>e)}var O=function(){function r(e){if(void 0===e&&(e={}),this.title="WebPorridge",this.options={db:this.title,json:!0,store:"(default)"},"undefined"!=typeof window&&!("indexedDB"in window))throw Error("Your browser does not support IndexedDB");this.options=t(t({},this.options),e),this.store=y(this.options.db,this.options.store)}return r.prototype.getItem=function(r,o,i){var u;return void 0===o&&(o=""),void 0===i&&(i={}),e(this,void 0,void 0,(function(){var e,c;return n(this,(function(n){switch(n.label){case 0:return i=t(t({},this.options),i),o?[4,this.getItem(r,null,i)]:[3,2];case 1:return e=n.sent()||{},[2,s.get(e,o)];case 2:return[4,w(r,this.store)];case 3:return[2,(c=null!==(u=n.sent())&&void 0!==u?u:null)&&h(c)&&!0===i.json?JSON.parse(c):c]}}))}))},r.prototype.getJSON=function(t,r){return void 0===r&&(r=""),e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,this.getItem(t,r,{json:!0})];case 1:return[2,e.sent()]}}))}))},r.prototype.getBase64=function(r,o,i){return void 0===o&&(o=""),void 0===i&&(i={}),e(this,void 0,void 0,(function(){var e,u,c;return n(this,(function(n){switch(n.label){case 0:return i=t(t({},this.options),i),[4,this.getItem(r,null,i)];case 1:return e=n.sent(),(null==o?void 0:o.length)||i.json?(c=f(e),u=(null==o?void 0:o.length)?s.get(c,o):c):u=f(e,!1),[2,u]}}))}))},r.prototype.getItems=function(r,o){return void 0===o&&(o={}),e(this,void 0,void 0,(function(){var i,s,u,c=this;return n(this,(function(a){switch(a.label){case 0:return p(r)?(u=(s=Promise).all,[4,r.map((function(r){return e(c,void 0,void 0,(function(){var e,s,u;return n(this,(function(n){switch(n.label){case 0:return"string"!=typeof r?[3,2]:[4,this.getItem(r,null,o)];case 1:return i=n.sent(),[2,o.keyVal?(e={},e[r]=i,e):i];case 2:return v(r)?(o=t(t({},o),r.options),[4,this.getItem(r.key,r.subKey,o)]):[3,4];case 3:return i=n.sent(),[2,o.keyVal?(s={},s[r.key]=i,s):i];case 4:return p(r)?(o=t(t({},o),r[2]),[4,this.getItem(r[0],r[1],o)]):[3,6];case 5:return i=n.sent(),[2,o.keyVal?(u={},u[r[0]]=i,u):i];case 6:return[2]}}))}))}))]):[3,3];case 1:return[4,u.apply(s,[a.sent()])];case 2:return[2,a.sent()];case 3:return[2]}}))}))},r.prototype.getMatch=function(t,r,o){return void 0===r&&(r=""),void 0===o&&(o={}),e(this,void 0,void 0,(function(){var e,i;return n(this,(function(n){switch(n.label){case 0:return[4,this.getMatches(t)];case 1:return(e=n.sent().map((function(t){return{key:t,subKey:r}}))).length?[4,this.getItems(e,o)]:[3,3];case 2:return i=n.sent(),[3,4];case 3:i=null,n.label=4;case 4:return[2,i]}}))}))},r.prototype.removeItem=function(t,r){return void 0===r&&(r=""),e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return r?[4,this.getItem(t)]:[3,3];case 1:return e=n.sent()||{},s.delete(e,r),[4,this.setItem(t,e)];case 2:return[2,n.sent()];case 3:return[4,j(t,this.store)];case 4:return[2,n.sent()]}}))}))},r.prototype.removeItems=function(t,r){return void 0===r&&(r=""),e(this,void 0,void 0,(function(){var o,i,s=this;return n(this,(function(u){switch(u.label){case 0:return p(t)?(i=(o=Promise).all,[4,t.map((function(t){return e(s,void 0,void 0,(function(){return n(this,(function(e){return"string"==typeof t?[2,this.removeItem(t,r)]:v(t)?[2,this.removeItem(t.key,t.subKey||r)]:p(t)?[2,this.removeItem(t[0],t[1]||r)]:[2]}))}))}))]):[3,3];case 1:return[4,i.apply(o,[u.sent()])];case 2:return[2,u.sent()];case 3:return[2]}}))}))},r.prototype.removeMatch=function(t,r){return void 0===r&&(r=""),e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return"*"===t&&this.clear(),[4,this.getMatches(t)];case 1:return[2,(e=n.sent()).length?this.removeItems(e,r):null]}}))}))},r.prototype.setItem=function(r,o,i,u){return void 0===i&&(i=""),void 0===u&&(u={}),e(this,void 0,void 0,(function(){var e,c;return n(this,(function(n){switch(n.label){case 0:return u=t(t({},this.options),u),(null==i?void 0:i.length)?[4,this.getItem(r)]:[3,3];case 1:return e=n.sent()||{},s.set(e,i,o),[4,this.setItem(r,e)];case 2:return[2,n.sent()];case 3:return c=!1===u.json?JSON.stringify(o):o,[4,I(r,c,this.store)];case 4:return[2,n.sent()]}}))}))},r.prototype.setItems=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,(function(){var o,i,s=this;return n(this,(function(u){switch(u.label){case 0:return p(t)?(i=(o=Promise).all,[4,t.map((function(t){return e(s,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return v(t)?[4,this.setItem(t.key,t.value,t.subKey,t.options||r)]:[3,2];case 1:return[2,e.sent()];case 2:return p(t)?[4,this.setItem(t[0],t[1],t[2],t[3]||r)]:[3,4];case 3:return[2,e.sent()];case 4:return[2]}}))}))}))]):[3,3];case 1:return[4,i.apply(o,[u.sent()])];case 2:return[2,u.sent()];case 3:return[2]}}))}))},r.prototype.setJSON=function(t,r,o){return void 0===o&&(o=""),e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,this.setItem(t,r,o,{json:!0})];case 1:return[2,e.sent()]}}))}))},r.prototype.key=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,k(this.store)];case 1:return[2,e.sent()[t]]}}))}))},Object.defineProperty(r.prototype,"length",{get:function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,k(this.store)];case 1:return[2,t.sent().length]}}))}))},enumerable:!1,configurable:!0}),r.prototype.clear=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,S(this.store)];case 1:return[2,t.sent()]}}))}))},r.prototype.getMatches=function(t){return e(this,void 0,void 0,(function(){var e,r,o,i,s;return n(this,(function(n){switch(n.label){case 0:return[4,this.length];case 1:e=n.sent(),r=[],o=0,n.label=2;case 2:return o<e?[4,this.key(o)]:[3,5];case 3:(i=n.sent())&&r.push(i),n.label=4;case 4:return o++,[3,2];case 5:return s=p(t)?t:[t],[2,a(r,s,{caseSensitive:!0})]}}))}))},r}();export{d as WebPorridge,O as WebPorridgeDB};