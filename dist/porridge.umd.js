!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).WebPorridge={})}(this,(function(e){"use strict";const t=e=>{const t=typeof e;return null!==e&&("object"===t||"function"===t)},r=new Set(["__proto__","prototype","constructor"]),n=new Set("0123456789");function i(e){const t=[];let i="",o="start",s=!1;for(const a of e)switch(a){case"\\":if("index"===o)throw new Error("Invalid character in an index");if("indexEnd"===o)throw new Error("Invalid character after an index");s&&(i+=a),o="property",s=!s;break;case".":if("index"===o)throw new Error("Invalid character in an index");if("indexEnd"===o){o="property";break}if(s){s=!1,i+=a;break}if(r.has(i))return[];t.push(i),i="",o="property";break;case"[":if("index"===o)throw new Error("Invalid character in an index");if("indexEnd"===o){o="index";break}if(s){s=!1,i+=a;break}if("property"===o){if(r.has(i))return[];t.push(i),i=""}o="index";break;case"]":if("index"===o){t.push(Number.parseInt(i,10)),i="",o="indexEnd";break}if("indexEnd"===o)throw new Error("Invalid character after an index");default:if("index"===o&&!n.has(a))throw new Error("Invalid character in an index");if("indexEnd"===o)throw new Error("Invalid character after an index");"start"===o&&(o="property"),s&&(s=!1,i+="\\"),i+=a}switch(s&&(i+="\\"),o){case"property":if(r.has(i))return[];t.push(i);break;case"index":throw new Error("Index was not closed");case"start":t.push("")}return t}function o(e,t){if("number"!=typeof t&&Array.isArray(e)){const r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function s(e,t){if(o(e,t))throw new Error("Cannot use string index")}const a="@value",c="@type",u="@expires";function l(e){switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Object]":return"object";case"[object BigInt]":return"bigint";case"[object Boolean]":return"boolean";case"[object Null]":return"null";case"[object Number]":return"number";case"[object String]":return"string";case"[object Undefined]":return"undefined"}}function d(e,t){try{window.dispatchEvent(new CustomEvent(e,{detail:t}))}catch(e){}}/*! web-porridge | MIT License | https://github.com/idleberg/web-porridge */
const f="web-porridge:storage.didChange",h=["localStorage","sessionStorage"];e.WebPorridge=class{type;constructor(e="localStorage"){if("undefined"!=typeof window&&!(e in window))throw Error(`Your browser does not support ${e}`);if(!h.includes(e))throw`Invalid storage type specified, try ${h.join("|")} instead`;this.type=e}setItem(e,r,n){if(n?.key?.length){const o=this.getItem(e)||{};return function(e,r,n){if(!t(e)||"string"!=typeof r)return e;const o=e,a=i(r);for(let r=0;r<a.length;r++){const i=a[r];s(e,i),r===a.length-1?e[i]=n:t(e[i])||(e[i]="number"==typeof a[r+1]?[]:{}),e=e[i]}}(o,n.key,r),this.setItem(e,o,{...n,key:void 0})}const o={[a]:(h=r,"bigint"==typeof h?h.toString():h),[c]:l(r)};var h;return n?.expires&&String(n.expires).length&&(o[u]=new Date(n.expires)),d(f,{key:e,value:r}),globalThis[this.type].setItem(e,JSON.stringify(o))}getItem(e,r){const n=globalThis[this.type].getItem(e);try{const e=JSON.parse(n);if(!e||(s=e[u])&&new Date(s)<=new Date)return null;const l=function(e){const t=e[a];switch(e[c]){case"boolean":case"null":case"number":case"object":case"undefined":return t;case"bigint":return BigInt(t);case"string":return t.toString();default:return e}}(e);return"object"===e[c]&&r?.key?.length?function(e,r,n){if(!t(e)||"string"!=typeof r)return void 0===n?e:n;const s=i(r);if(0===s.length)return n;for(let t=0;t<s.length;t++){const r=s[t];if(null==(e=o(e,r)?t===s.length-1?void 0:null:e[r])){if(t!==s.length-1)return n;break}}return void 0===e?n:e}(l,r.key):l}catch(e){return n}var s}removeItem(e,r=""){if(r?.length){const n=this.getItem(e)||{};return function(e,r){if(!t(e)||"string"!=typeof r)return!1;const n=i(r);for(let r=0;r<n.length;r++){const i=n[r];if(s(e,i),r===n.length-1)return delete e[i],!0;if(e=e[i],!t(e))return!1}}(n,r),this.setItem(e,n)}return d(f,{key:e,value:null}),globalThis[this.type].removeItem(e)}key(e){return globalThis[this.type].key(e)}get length(){return globalThis[this.type].length}clear(){return d(f,{value:null}),globalThis[this.type].clear()}hasItem(e){return Object.keys(globalThis[this.type]).includes(e)}keys(){return Object.keys(globalThis[this.type])}values(){return Object.keys(globalThis[this.type]).map((e=>this.getItem(e)))}entries(){return Object.keys(globalThis[this.type]).map((e=>[e,this.getItem(e)]))}observe(e,t){!function(e,t,r){window.addEventListener(e,(e=>{e.detail.key!==t&&void 0!==e.detail.key||r(e.detail.value)}))}(f,e,t)}},Object.defineProperty(e,"__esModule",{value:!0})}));//# sourceMappingURL=porridge.umd.js.map
