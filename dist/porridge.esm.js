const e=e=>{const t=typeof e;return null!==e&&("object"===t||"function"===t)},t=new Set(["__proto__","prototype","constructor"]),r=new Set("0123456789");function n(e){const n=[];let i="",o="start",s=!1;for(const a of e)switch(a){case"\\":if("index"===o)throw new Error("Invalid character in an index");if("indexEnd"===o)throw new Error("Invalid character after an index");s&&(i+=a),o="property",s=!s;break;case".":if("index"===o)throw new Error("Invalid character in an index");if("indexEnd"===o){o="property";break}if(s){s=!1,i+=a;break}if(t.has(i))return[];n.push(i),i="",o="property";break;case"[":if("index"===o)throw new Error("Invalid character in an index");if("indexEnd"===o){o="index";break}if(s){s=!1,i+=a;break}if("property"===o){if(t.has(i))return[];n.push(i),i=""}o="index";break;case"]":if("index"===o){n.push(Number.parseInt(i,10)),i="",o="indexEnd";break}if("indexEnd"===o)throw new Error("Invalid character after an index");default:if("index"===o&&!r.has(a))throw new Error("Invalid character in an index");if("indexEnd"===o)throw new Error("Invalid character after an index");"start"===o&&(o="property"),s&&(s=!1,i+="\\"),i+=a}switch(s&&(i+="\\"),o){case"property":if(t.has(i))return[];n.push(i);break;case"index":throw new Error("Index was not closed");case"start":n.push("")}return n}function i(e,t){if("number"!=typeof t&&Array.isArray(e)){const r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function o(e,t){if(i(e,t))throw new Error("Cannot use string index")}const s="@value",a="@type",c="@expires";function l(e){switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Object]":return"object";case"[object BigInt]":return"bigint";case"[object Boolean]":return"boolean";case"[object Null]":return"null";case"[object Number]":return"number";case"[object String]":return"string";case"[object Undefined]":return"undefined"}}function u(e,t){try{window.dispatchEvent(new CustomEvent(e,{detail:t}))}catch(e){}}/*! web-porridge | MIT License | https://github.com/idleberg/web-porridge */
const h="web-porridge:storage.didChange",d=["localStorage","sessionStorage"];class f{store;constructor(e="localStorage"){if("undefined"!=typeof window&&!(e in window))throw Error(`Your browser does not support ${e}`);if(!d.includes(e))throw`Invalid storage type specified, try ${d.join("|")} instead`;this.store=e}setItem(t,r,i){if(i?.key?.length){const s=this.getItem(t)||{};return function(t,r,i){if(!e(t)||"string"!=typeof r)return t;const s=t,a=n(r);for(let r=0;r<a.length;r++){const n=a[r];o(t,n),r===a.length-1?t[n]=i:e(t[n])||(t[n]="number"==typeof a[r+1]?[]:{}),t=t[n]}}(s,i.key,r),this.setItem(t,s,{...i,key:void 0})}const d={[s]:(f=r,"bigint"==typeof f?f.toString():f),[a]:l(r)};var f;return i?.expires&&String(i.expires).length&&(d[c]=new Date(i.expires)),u(h,{key:t,value:r}),globalThis[this.store].setItem(t,JSON.stringify(d))}getItem(t,r){const o=globalThis[this.store].getItem(t);try{const t=JSON.parse(o);if(!t||(l=t[c])&&new Date(l)<=new Date)return null;const u=function(e){const t=e[s];switch(e[a]){case"boolean":case"null":case"number":case"object":case"undefined":return t;case"bigint":return BigInt(t);case"string":return t.toString();default:return e}}(t);return"object"===t[a]&&r?.key?.length?function(t,r,o){if(!e(t)||"string"!=typeof r)return void 0===o?t:o;const s=n(r);if(0===s.length)return o;for(let e=0;e<s.length;e++){const r=s[e];if(null==(t=i(t,r)?e===s.length-1?void 0:null:t[r])){if(e!==s.length-1)return o;break}}return void 0===t?o:t}(u,r.key):u}catch(e){return o}var l}removeItem(t,r=""){if(r?.length){const i=this.getItem(t)||{};return function(t,r){if(!e(t)||"string"!=typeof r)return!1;const i=n(r);for(let r=0;r<i.length;r++){const n=i[r];if(o(t,n),r===i.length-1)return delete t[n],!0;if(t=t[n],!e(t))return!1}}(i,r),this.setItem(t,i)}return u(h,{key:t,value:null}),globalThis[this.store].removeItem(t)}key(e){return globalThis[this.store].key(e)}get length(){return globalThis[this.store].length}clear(){return u(h,{value:null}),globalThis[this.store].clear()}hasItem(e){return Object.keys(globalThis[this.store]).includes(e)}keys(){return Object.keys(globalThis[this.store])}values(){return Object.keys(globalThis[this.store]).map((e=>this.getItem(e)))}entries(){return Object.keys(globalThis[this.store]).map((e=>[e,this.getItem(e)]))}observe(e,t){!function(e,t,r){window.addEventListener(e,(e=>{e.detail.key!==t&&void 0!==e.detail.key||r({key:t,value:e.detail.value})}))}(h,e,t)}}export{f as WebPorridge};//# sourceMappingURL=porridge.esm.js.map
